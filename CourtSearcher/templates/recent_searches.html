{% extends "base.html" %}
{% block title %}Recent Searches{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="text-center mb-4">
      <h2 class="display-6">
        <i class="fas fa-history text-info me-2"></i>Recent Case Searches
      </h2>
      <p class="text-muted">Showing the latest {{ queries|length }} searches.</p>
    </div>

    {% if queries %}
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Case</th>
            <th>Timestamp (UTC)</th>
            <th>Success</th>
            <th>IP Address</th>
            <th>User Agent</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for q in queries %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="{{ url_for('search_case') }}"
                 onclick="event.preventDefault(); document.getElementById('replay-form-{{ q.id }}').submit();">
                {{ q.case_type }}/{{ q.case_number }}/{{ q.filing_year }}
              </a>
              <form id="replay-form-{{ q.id }}" method="POST"
                    action="{{ url_for('search_case') }}" style="display:none;">
                {{ csrf_token() }}
                <input type="hidden" name="case_type" value="{{ q.case_type }}">
                <input type="hidden" name="case_number" value="{{ q.case_number }}">
                <input type="hidden" name="filing_year" value="{{ q.filing_year }}">
              </form>
            </td>
            <td>{{ q.query_timestamp }}</td>
            <td>
              {% if q.success %}
                <span class="badge bg-success">Yes</span>
              {% else %}
                <span class="badge bg-danger">No</span>
              {% endif %}
            </td>
            <td>{{ q.ip_address }}</td>
            <td class="text-truncate" style="max-width: 250px;">{{ q.user_agent }}</td>
            <td>
              <a href="#" class="btn btn-sm btn-secondary disabled">
                <i class="fas fa-eye"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="alert alert-warning text-center">
      <i class="fas fa-info-circle me-2"></i>No searches found.
    </div>
    {% endif %}

    <div class="text-center mt-4">
      <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
        <i class="fas fa-lightbulb me-1"></i>Search Again
      </a>
    </div>
  </div>
</div>
{% endblock %}
